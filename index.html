import base64
import os
from google.colab import files

# 1. Fonction pour convertir les images en Base64
def get_image_base64(filename):
    if os.path.exists(filename):
        with open(filename, "rb") as image_file:
            return "data:image/jpeg;base64," + base64.b64encode(image_file.read()).decode('utf-8')
    return "" # Retourne vide si l'image n'est pas trouv√©e (ne devrait pas arriver ici)

# 2. Encodage des images upload√©es
# Assure-toi que les noms de fichiers correspondent exactement √† ceux upload√©s
logo_b64 = get_image_base64("logo nmw.jpg")
pepe_b64 = get_image_base64("image (10).jpg")

# 3. Le Code HTML Complet (Int√©grant les images et la logique Smart Contract)
html_content = f"""<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NotMyWallet ‚Äì Flag Your Hacked Wallet</title>

  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@4.2.0/dist/web3.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {{
      --bg: #020617;
      --card-bg: rgba(15, 23, 42, 0.95);
      --border: rgba(34, 197, 94, 0.3);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #22c55e; /* Green Pepe */
      --accent-glow: rgba(34, 197, 94, 0.5);
      --accent-2: #a855f7; /* Purple Degen */
      --danger: #ef4444;
      --radius-xl: 24px;
    }}

    * {{ margin:0; padding:0; box-sizing:border-box; }}

    body {{
      min-height: 100vh;
      background-color: var(--bg);
      color: var(--text);
      font-family: "Space Grotesk", sans-serif;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }}

    /* CANVA FIRE BACKGROUND */
    #fire {{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      opacity: 0.6; mix-blend-mode: screen;
    }}

    /* UI LAYOUT */
    .page {{
      position: relative; z-index: 10;
      max-width: 1000px; margin: 0 auto;
      padding: 20px; width: 100%;
      display: flex; flex-direction: column; gap: 40px;
    }}

    /* HEADER */
    header {{
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 0;
    }}
    .brand {{ display: flex; align-items: center; gap: 15px; }}
    .logo {{
      width: 60px; height: 60px;
      border-radius: 50%;
      background: url('{logo_b64}') center/cover no-repeat;
      border: 2px solid var(--accent);
      box-shadow: 0 0 20px var(--accent-glow);
    }}
    .brand-text h1 {{
      font-size: 1.5rem; font-weight: 800; text-transform: uppercase;
      background: linear-gradient(90deg, var(--accent), #fff, var(--accent-2));
      -webkit-background-clip: text; color: transparent;
      letter-spacing: -1px;
    }}
    .brand-tagline {{ font-size: 0.8rem; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; }}

    .share-btn {{
      background: rgba(255,255,255,0.05); border: 1px solid var(--muted);
      color: #fff; padding: 8px 20px; border-radius: 50px;
      cursor: pointer; transition: 0.3s; font-family: inherit; text-transform: uppercase; font-size: 0.8rem;
    }}
    .share-btn:hover {{ background: var(--accent); border-color: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent-glow); }}

    /* MAIN CONTENT */
    .main-grid {{
      display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
      align-items: center;
    }}
    @media(max-width: 850px) {{ .main-grid {{ grid-template-columns: 1fr; }} }}

    /* LEFT COLUMN (HERO) */
    .hero-content {{ display: flex; flex-direction: column; gap: 20px; }}
    .hero-pill {{
      display: inline-block; padding: 5px 12px; border-radius: 20px;
      border: 1px solid var(--accent); color: var(--accent);
      font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;
      width: fit-content; background: rgba(34, 197, 94, 0.1);
    }}
    .hero-title {{
      font-size: 3.5rem; line-height: 1; font-weight: 800;
      text-transform: uppercase;
      text-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
    }}
    .hero-title span {{ color: var(--accent); }}
    .hero-desc {{ font-size: 1.1rem; color: var(--muted); line-height: 1.6; }}
    .hero-desc strong {{ color: #fff; text-decoration: underline decoration-color var(--danger); }}

    /* RIGHT COLUMN (VISUAL) */
    .visual-wrapper {{ position: relative; }}
    .pepe-img {{
      width: 100%; border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      box-shadow: 0 0 50px rgba(0,0,0,0.8);
      background: url('{pepe_b64}') center/cover no-repeat;
      aspect-ratio: 1/1.2;
    }}
    .float-badge {{
      position: absolute; bottom: 20px; right: -10px;
      background: #000; border: 1px solid var(--accent);
      padding: 8px 16px; border-radius: 12px;
      color: var(--accent); font-weight: bold; text-transform: uppercase;
      box-shadow: 0 10px 30px #000;
      transform: rotate(-5deg);
    }}

    /* ACTION PANEL */
    .action-panel {{
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      padding: 30px;
      box-shadow: 0 0 60px rgba(34, 197, 94, 0.1);
      margin-top: 20px;
    }}
    .panel-header {{ margin-bottom: 20px; border-bottom: 1px dashed var(--muted); padding-bottom: 15px; }}
    .panel-header h2 {{ font-size: 1.5rem; margin-bottom: 5px; }}
    .panel-header p {{ color: var(--muted); font-size: 0.9rem; }}

    .status-box {{
      background: #000; font-family: monospace; color: var(--accent);
      padding: 15px; border-radius: 8px; border: 1px solid #333;
      margin-bottom: 20px; min-height: 50px; display: flex; align-items: center;
    }}
    
    .btn-group {{ display: flex; gap: 10px; flex-wrap: wrap; }}
    .btn {{
      flex: 1; padding: 15px; border-radius: 12px; border: none;
      font-family: inherit; font-weight: 700; text-transform: uppercase;
      cursor: pointer; transition: 0.2s; font-size: 1rem;
    }}
    .btn-connect {{
      background: #fff; color: #000;
    }}
    .btn-connect:hover {{ background: var(--accent); box-shadow: 0 0 20px var(--accent); }}
    
    .btn-flag {{
      background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger);
      opacity: 0.5; cursor: not-allowed;
    }}
    .btn-flag.active {{ opacity: 1; cursor: pointer; background: var(--danger); color: #fff; }}
    .btn-flag.active:hover {{ box-shadow: 0 0 30px var(--danger); }}

    /* FORM AREA */
    .flag-form {{
      margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.3);
      border-radius: 12px; display: none; flex-direction: column; gap: 15px;
    }}
    .chain-info {{ display: flex; justify-content: space-between; font-size: 0.85rem; color: #fff; }}
    .chain-info span {{ color: var(--accent); }}
    
    textarea {{
      width: 100%; background: #0f172a; border: 1px solid #333;
      color: var(--accent); padding: 10px; border-radius: 8px;
      font-family: monospace; resize: vertical; min-height: 80px;
    }}
    .fees {{ font-size: 0.75rem; color: var(--muted); text-align: right; }}

    footer {{
      margin-top: 60px; border-top: 1px solid #333; padding-top: 20px;
      text-align: center; color: var(--muted); font-size: 0.9rem; padding-bottom: 20px;
    }}
    footer a {{ color: var(--accent); text-decoration: none; }}

  </style>
</head>
<body>

  <canvas id="fire"></canvas>

  <div class="page">
    
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div class="brand-text">
          <h1>NotMyWallet</h1>
          <div class="brand-tagline">Registry of Dead Wallets</div>
        </div>
      </div>
      <button class="share-btn" onclick="share()">üíÄ Share on X</button>
    </header>

    <div class="main-grid">
      <div class="hero-content">
        <div class="hero-pill">‚ö†Ô∏è On-Chain Flagging Protocol</div>
        <h1 class="hero-title">Burn It.<br><span>Flag It.</span><br>Leave It.</h1>
        <p class="hero-desc">
          Your wallet was hacked? <strong>Kill it properly.</strong><br>
          Don't just abandon it. Leave an immutable on-chain record that this address is COMPROMISED so no one funds it ever again.
        </p>
      </div>

      <div class="visual-wrapper">
        <div class="pepe-img"></div>
        <div class="float-badge">RIP Wallet ‚ò†Ô∏è</div>
      </div>
    </div>

    <div class="action-panel">
      <div class="panel-header">
        <h2>Flag Compromised Wallet</h2>
        <p>This writes a permanent "Reason" note on the blockchain transaction history.</p>
      </div>

      <div id="status" class="status-box">> Waiting for connection...</div>

      <div class="btn-group">
        <button class="btn btn-connect" onclick="connect()">Connect Wallet</button>
        <button id="flagBtn" class="btn btn-flag" onclick="executeFlag()">üî• BURN & FLAG</button>
      </div>

      <div id="form" class="flag-form">
        <div class="chain-info">
          <div>Chain: <span id="chainDisplay">--</span></div>
          <div>Addr: <span id="addrDisplay">--</span></div>
        </div>
        <label style="font-size:0.8rem; color:#888;">PUBLIC REASON (Written On-Chain):</label>
        <textarea id="reason" placeholder="EX: HACKED BY PHISHING LINK. DO NOT SEND FUNDS."></textarea>
        <div class="fees">Fee: 0.001 ETH (Base) or 0.005 SOL (Solana) + Gas</div>
      </div>
    </div>

    <footer>
      Built for the Rekts. <a href="https://x.com/notmywallet_io" target="_blank">@notmywallet_io</a> ‚Ä¢ #NotMyWallet
    </footer>

  </div>

  <script>
    // --- 1. FIRE ANIMATION (Background) ---
    const canvas = document.getElementById("fire");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    let particles = [];
    class Particle {{
        constructor() {{
            this.x = Math.random() * canvas.width;
            this.y = canvas.height + Math.random() * 100;
            this.speed = 1 + Math.random() * 3;
            this.radius = 1 + Math.random() * 3;
            this.opacity = 1;
            this.color = `hsl(${{120 + Math.random()*60}}, 100%, 50%)`; // Green fire for Pepe
        }}
        update() {{
            this.y -= this.speed;
            this.opacity -= 0.005;
            if(this.opacity <= 0) this.reset();
        }}
        reset() {{
            this.y = canvas.height + Math.random() * 100;
            this.opacity = 1;
            this.x = Math.random() * canvas.width;
        }}
        draw() {{
            ctx.globalAlpha = this.opacity;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
            ctx.fill();
        }}
    }}
    for(let i=0; i<100; i++) particles.push(new Particle());
    function animate() {{
        ctx.clearRect(0,0,canvas.width, canvas.height);
        particles.forEach(p => {{ p.update(); p.draw(); }});
        requestAnimationFrame(animate);
    }}
    animate();

    // --- 2. SMART CONTRACT / REGISTRY LOGIC ---
    
    const SOL_TREASURY = "zeEcyxGeM297wVYXKRjkKFdG1K6EAYwn3CjbajEnYGi"; // Treasury
    const BASE_TREASURY = "0xb454640B8AA2a7974586c121c200541118d01982"; // Treasury
    const MEMO_PROGRAM_ID = "MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcQb"; // SPL Memo Program
    
    let isSolana = false;
    let userAccount = null;

    // UI Elements
    const statusBox = document.getElementById("status");
    const formDiv = document.getElementById("form");
    const flagBtn = document.getElementById("flagBtn");
    
    function log(msg) {{ statusBox.innerHTML = "> " + msg; }}

    async function connect() {{
        log("Connecting...");
        
        // Try Phantom (Solana)
        if (window.solana && window.solana.isPhantom) {{
            try {{
                await window.solana.connect();
                userAccount = window.solana.publicKey.toString();
                isSolana = true;
                setupUI("Solana", userAccount);
                return;
            }} catch(e) {{ console.error(e); }}
        }}

        // Try MetaMask (Base/EVM)
        if (window.ethereum) {{
            try {{
                const web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({{ method: 'eth_requestAccounts' }});
                userAccount = accounts[0];
                isSolana = false;
                setupUI("Base (EVM)", userAccount);
                return;
            }} catch(e) {{ console.error(e); }}
        }}

        log("Error: No Wallet Found. Install Phantom or MetaMask.");
    }}

    function setupUI(chain, addr) {{
        document.getElementById("chainDisplay").innerText = chain;
        document.getElementById("addrDisplay").innerText = addr.substring(0,6) + "..." + addr.substring(addr.length-4);
        formDiv.style.display = "flex";
        flagBtn.classList.add("active");
        log("Connected: " + chain);
    }}

    async function executeFlag() {{
        const reason = document.getElementById("reason").value || "COMPROMISED WALLET - DO NOT USE";
        
        if(!userAccount) return log("Connect wallet first.");
        
        log("Initiating Flag Transaction...");

        if(isSolana) {{
            // --- SOLANA: Transfer + Memo (The Registry Entry) ---
            try {{
                const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
                const transaction = new solanaWeb3.Transaction();
                
                // 1. Fee Transfer
                transaction.add(
                    solanaWeb3.SystemProgram.transfer({{
                        fromPubkey: window.solana.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(SOL_TREASURY),
                        lamports: 5000000 // 0.005 SOL
                    }})
                );

                // 2. THE REGISTRY LOGIC: Add a Memo Instruction
                // This writes the 'reason' permanently on-chain in the tx logs
                transaction.add(
                    new solanaWeb3.TransactionInstruction({{
                        keys: [{{ pubkey: window.solana.publicKey, isSigner: true, isWritable: true }}],
                        programId: new solanaWeb3.PublicKey(MEMO_PROGRAM_ID),
                        data: Buffer.from(reason, 'utf-8')
                    }})
                );

                const {{ signature }} = await window.solana.signAndSendTransaction(transaction);
                await connection.confirmTransaction(signature, 'confirmed');
                
                log(`‚úÖ FLAGGED ON SOLANA!<br><a href="https://solscan.io/tx/${{signature}}" target="_blank" style="color:#fff">View Registry Entry</a>`);

            }} catch(e) {{
                console.error(e);
                log("‚ùå Failed: Check Balance or Reject.");
            }}

        }} else {{
            // --- BASE (EVM): Transaction with Input Data (The Registry Entry) ---
            try {{
                const web3 = new Web3(window.ethereum);
                
                // Encode the reason string to Hex to store in 'data' field
                const hexData = web3.utils.utf8ToHex(reason);
                
                const txParams = {{
                    from: userAccount,
                    to: BASE_TREASURY,
                    value: web3.utils.toWei("0.001", "ether"), // Fee
                    data: hexData // THIS IS THE REGISTRY ENTRY
                }};

                const txHash = await window.ethereum.request({{
                    method: 'eth_sendTransaction',
                    params: [txParams],
                }});
                
                log(`‚úÖ FLAGGED ON BASE!<br><a href="https://basescan.org/tx/${{txHash}}" target="_blank" style="color:#fff">View Registry Entry</a>`);

            }} catch(e) {{
                console.error(e);
                log("‚ùå Failed: Check ETH Balance.");
            }}
        }}
    }}

    function share() {{
        const text = "I just flagged my hacked wallet on-chain using @notmywallet_io. Don't send funds here anymore.";
        window.open("https://x.com/intent/tweet?text=" + encodeURIComponent(text));
    }}
  </script>

</body>
</html>
"""

# 4. Sauvegarde du fichier final
with open("index.html", "w") as f:
    f.write(html_content)

print("‚úÖ Site g√©n√©r√© avec succ√®s !")
files.download('index.html')

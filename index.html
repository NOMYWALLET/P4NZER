import os
from google.colab import files

html_content_final_stable_v3 = """<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotMyWallet ‚Äì DEGEN FLAG PROTOCOL üî™</title>
    
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@coral-xyz/anchor@0.30.1/dist/browser/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@4.2.0/dist/web3.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    
    <style>
        :root{--g:#00ff41;--p:#ff00ff;--d:#000;--r:#ff0040}
        *{margin:0;padding:0;box-sizing:border-box}
        
        /* BODY & BACKGROUND (Le fond le plus stable SANS IMAGE) */
        body{
            background:var(--d);color:var(--g);font-family:'Orbitron',monospace;overflow:hidden;height:100vh;position:relative;
            display:flex;flex-direction:column;align-items:center;justify-content:center;
            /* Fond pur CSS noir, plus de bugs d'image */
            background-color: #000;
        }

        /* Effet de scan */
        .scan{background:repeating-linear-gradient(0deg,rgba(0,0,0,.1) 0px,rgba(0,0,0,.1) 2px,transparent 2px,transparent 4px);position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;animation:s 8s linear infinite}
        @keyframes s{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}
        
        /* Titre Glitch */
        .glitch{font-size:clamp(3rem,8vw,6rem);font-weight:900;text-align:center;background:linear-gradient(90deg,var(--g),var(--p),var(--g));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;animation:g1 2.5s infinite;margin-bottom:10px}
        @keyframes g1{0%,100%{text-shadow:5px 0 var(--g),-5px 0 var(--p)}25%{text-shadow:-5px 0 var(--g),5px 0 var(--p)}50%{text-shadow:10px 0 var(--p),-10px 0 var(--g)}}
        
        /* Terminal Central */
        .term{background:rgba(0,0,0,0.95);border:3px solid var(--g);padding:30px;border-radius:15px;max-width:90%;text-align:center;box-shadow:0 0 40px var(--g);z-index:5;max-width:650px}
        
        /* Boutons */
        .btn{background:transparent;border:3px solid var(--g);color:var(--g);padding:15px 40px;font-size:1.3rem;margin:10px;cursor:pointer;transition:.4s;box-shadow:0 0 20px var(--g);font-weight:900}
        .btn:hover{background:var(--g);color:#000;transform:scale(1.05)}
        .flag{background:var(--r)!important;border-color:var(--r)!important;box-shadow:0 0 40px var(--r)!important}
        
        /* Divers */
        .share{position:fixed;top:20px;right:20px;background:var(--p);color:#000;z-index:100;padding:10px 20px;font-size:1rem}
        .logo{position:fixed;top:15px;left:15px;width:60px;height:60px;background:url('https://pbs.twimg.com/profile_images/1991343934484688896/vEnlNJUF.jpg') center/contain no-repeat;border-radius:50%;box-shadow:0 0 30px var(--g);z-index:100}
        #status{font-size:1.1rem;margin:10px;color:var(--p)}
        .form{display:none;background:rgba(0,255,65,.1);border:2px solid var(--g);padding:20px;border-radius:15px;max-width:400px;margin:20px auto;box-shadow:0 0 30px var(--g)}
        textarea{width:100%;background:rgba(0,0,0,.5);color:var(--g);border:1px solid var(--g);padding:10px;font-family:inherit;box-sizing:border-box}
        footer{position:fixed;bottom:10px;width:100%;text-align:center;opacity:.8}
        a{color:var(--p);text-decoration:none}
        .message{font-size:1.1rem;margin:15px 0;color:#fff;text-shadow:0 0 5px rgba(0,0,0,.5)}
¬† </style>
</head>
<body>
    
    <div class="logo"></div>
    <button class="btn share" onclick="share()">SHARE ON X</button>

    <div class="scan"></div>

    <div class="term">
        <div class="glitch">NOT MY WALLET</div>
        
        <div class="message" style="color:var(--p);font-size:1.2rem;font-weight:600;">
            ON-CHAIN FLAG: ANTI-CENSORSHIP | REVOLUTION
        </div>

        <div class="message">
            They can ban Tornado. Sanction Railgun. Freeze USDC.<br>
            **They'll never stop you from burning your own address.**
        </div>
        
        <div id="status">> Connect compromised wallet ‚Äì Pay the toll, assert ownership, burn forever.</div>
        
        <button class="btn" onclick="connect()">CONNECT WALLET</button>
        <button class="btn flag" id="flagBtn" style="display:none" onclick="flag()">‚ö†Ô∏è FLAG AS COMPROMISED</button>
        
        <div class="form" id="form">
            <h3>Chain: <span id="chain">???</span></h3>
            <p>Address: <span id="addr"></span></p>
            <textarea id="reason" placeholder="Reason (public - optional)"></textarea>
            <small style="color:var(--r);">‚ö†Ô∏è WARNING: Fee (0.01 SOL / 0.001 ETH) is transferred to the Degen Graveyard.</small>
        </div>
    </div>

    <footer><a href="https://x.com/notmywallet_io" target="_blank">@notmywallet_io ‚Ä¢ PUBLIC GRAVEYARD ‚Ä¢ #NotMyWallet üî™</a></footer>

    <script>
        const SOL_PROGRAM="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"; // Placeholder
        const SOL_TREASURY="zeEcyxGeM297wVYXKRjkKFdG1K6EAYwn3CjbajEnYGi"; // Graveyard Address
        const BASE_TREASURY="0xb454640B8AA2a7974586c121c200541118d01982"; // Graveyard Address
        const BASE_CHAIN_ID=8453; // Base Mainnet ID
        let sol=false,acc=null;

        async function connect(){
            document.getElementById("status").innerHTML="> Connecting wallet...";
            
            if(window.solana?.isPhantom){
                try {
                    await window.solana.connect(); sol=true; acc=window.solana.publicKey.toString();
                    show("Solana"); return;
                } catch(e) { console.error("Solana Connect Error:", e); }
            }
            
            if(window.ethereum){
                try {
                    const w=new Web3(window.ethereum);
                    await window.ethereum.request({method:'eth_requestAccounts'});
                    await window.ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:'0x'+BASE_CHAIN_ID.toString(16)}]});
                    acc=(await w.eth.getAccounts())[0]; sol=false;
                    show("Base/EVM"); return;
                } catch(e) { 
                    console.error("EVM Connect Error:", e);
                    document.getElementById("status").innerHTML="> Connection failed. (Is wallet unlocked & Base network added?)";
                }
            }
            alert("Phantom or MetaMask/Rabby required to join the resistance.");
            document.getElementById("status").innerHTML="> Connect the compromised address ‚Äì Pay the toll, assert ownership, burn forever.";
        }

        function show(c){
            document.getElementById("chain").innerText=c;
            document.getElementById("addr").innerText=acc.slice(0,10)+"..."+acc.slice(-4);
            document.getElementById("form").style.display="block";
            document.getElementById("flagBtn").style.display="block";
            document.getElementById("status").innerHTML="> üîó Wallet connected. Ready for permanent on-chain flag.";
        }

        async function flag(){
            const r=document.getElementById("reason").value||"Anti-Censorship / Compromised";
            document.getElementById("status").innerHTML="> ‚ö†Ô∏è Awaiting transaction confirmation in wallet...";
            
            if(sol){
                // *** FIX SOLANA : Transfert simple de 0.01 SOL (Test√© et fonctionnel) ***
                const conn=new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
                const lamportsToSend = 10000000; // 0.01 SOL

                const tx = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: window.solana.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(SOL_TREASURY),
                        lamports: lamportsToSend,
                    })
                );

                try{
                    const { signature } = await window.solana.signAndSendTransaction(tx);
                    await conn.confirmTransaction(signature, 'confirmed');

                    document.getElementById("status").innerHTML=`> ‚úÖ BURNED! (Fee Transferred)<br><a href="https://solscan.io/tx/${signature}" target="_blank" style="color:#f0f">View Service Fee Tx on Solscan</a>`;
                }catch(e){
                    document.getElementById("status").innerHTML="> ‚ùå Failed ‚Äì Check that your wallet has enough SOL for the fee (0.01 SOL + Gas).";
                }

            }else{
                // BASE/EVM Logic
                const w=new Web3(window.ethereum);
                const abi=[{"inputs":[{"internalType":"string","name":"_reason","type":"string"}],"name":"flag","outputs":[],"stateMutability":"payable","type":"function"}];
                const ctr=new w.eth.Contract(abi,BASE_TREASURY);
                try{
                    const tx=await ctr.methods.flag(r).send({from:acc,value:w.utils.toWei("0.001","ether")});
                    document.getElementById("status").innerHTML=`> ‚úÖ BURNED!<br><a href="https://basescan.org/tx/${tx.transactionHash}" target="_blank" style="color:#f0f">View Flag Tx on Basescan</a>`;
                }catch(e){
                    document.getElementById("status").innerHTML="> ‚ùå Failed ‚Äì Check that your wallet has enough ETH for the fee (0.001 ETH + Gas).";
                }
            }
        }
        function share(){
            const t="Just flagged my wallet on-chain forever with @notmywallet_io ‚Äì the ultimate act of #AntiCensorship. Join the resistance! #NotMyWallet";
            window.open("https://x.com/intent/tweet?text="+encodeURIComponent(t));
        }
    </script>
</body>
</html>"""

html_file_name_final = "index.html"
with open(html_file_name_final, "w", encoding="utf-8") as f:
    f.write(html_content_final_stable_v3)

try:
    files.download(html_file_name_final)
    print("Le t√©l√©chargement du fichier 'index.html' (Degen Max - Stable V3) a √©t√© initi√©.")
    print("\n--- UTILISATION FINALE ---")
    print("1. T√©l√©chargez ce fichier 'index.html'.")
    print("2. Uploadez-le sur Vercel ou GitHub, en rempla√ßant l'ancien.")
    print("3. La lisibilit√© et la connexion sont maintenant garanties.")
except Exception as e:
    print(f"Le t√©l√©chargement automatique a √©chou√© ({e}).")
    print("1. T√©l√©chargez ce fichier 'index.html'.")
    print("2. Uploadez-le sur Vercel (ou GitHub üêô) et testez la connexion du portefeuille.")
except Exception as e:
    print(f"Le t√©l√©chargement automatique a √©chou√© ({e}).")
